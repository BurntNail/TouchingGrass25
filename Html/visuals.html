<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="mystyle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(45deg, #1a5001, #c5c6a5, #006278);
            animation: gradientAnimation 10s ease infinite;
            background-size: 200% 200%;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Website</title>

    <script>
        function readFile(file) {
            return new Promise((resolve, reject) => {
                // Create file reader
                let reader = new FileReader()

                // Register event listeners
                reader.addEventListener("loadend", e => resolve(new Uint8Array(e.target.result)))
                reader.addEventListener("error", reject)

                // Read file
                reader.readAsArrayBuffer(file)
            })
        }

        document.addEventListener("DOMContentLoaded", () => {
            let form = document.querySelector("form");
            let name = document.querySelector("input#UserName");
            let file = document.querySelector("input#myFile");

            form.addEventListener("submit", (event) => {
                event.preventDefault();

                let actualFile = file.files[0];

                readFile(actualFile).then(array => {
                    let form_body = {
                        name: name.value,
                        file: array.toBase64()
                    };
                    
                    document.getElementById("loadingPopup").style.display = "flex";

                    fetch("https://theisland.fly.dev/submit_grass", {
                        method: "POST",
                        body: new URLSearchParams(form_body)
                    }).then(rsp => {
                        rsp.text().then(loc => {
                            document.location = loc;
                        })
                    })
                });
            });
        });
    </script>
</head>
<body>
    <header>
        <h1>Green Analysis</h1>
        <div class="button-container">
        <button class="fancy-button" onclick="window.location.href='index.html'">Home</button>
        <button class="fancy-button" onclick="window.location.href='visuals.html'">Submission</button>
        </div>
        
    </header>
   
    <div class = "blog">
        <title>Upload your image below and we'll tell you how green it is!</title>
        <div class = "container">
            <div class = "form-container">
            <form action="theisland.fly.dev/submit_grass">
            <label for="UserName">Enter your name:</label>
            <input type="text" id="UserName" name="UserName" placeholder="Eg.  Bob Vance" required>
            <label for="myFile" id="fileLabel" class="fancy-button">Choose File</label>
            <input type="file" id="myFile" name="filename" style="display: none;" accept="image/*">
            <input type="submit" class ="submit-button" value="Submit">
            </form>
            </div>
        </div>
    </div>
    <footer>
        <p>&copy; 2025 DataViz. All rights reserved.</p>
        <div class="social-icons">
            <p class = "Footer-text"> Jack Maguire, Michalina Dymitruk, Simon Lynch</p>
            <a href="https://github.com/BurntNail/TouchingGrass25" class="icon github"><i class="fab fa-github"></i></a>
            <a href="https://www.instagram.com/sta.chud.soc?utm_source=ig_web_button_share_sheet&igsh=ZDNlZDc0MzIxNw==" class="icon instagram"><i class="fab fa-instagram"></i></a>
        </div>
    </footer>
    <!-- Loading Popup -->
    <div id="loadingPopup">
    <div class="loading-content">
        <div class="spinner"></div>
        <p>Analyzing your image... ðŸŒ¿</p>
    </div>
    </div>
    <script>
        const fileInput = document.getElementById("myFile");
        const fileLabel = document.getElementById("fileLabel");

        fileInput.addEventListener("change", function() {
        if (fileInput.files.length > 0) {
            const fileName = fileInput.files[0].name;
            fileLabel.textContent = `âœ” ${fileName} selected`;
            fileLabel.style.backgroundColor = "#27ae60"; // green shade
        } else {
            fileLabel.textContent = "Choose File";
            fileLabel.style.backgroundColor = "#4720bc"; // original color
        }
        });
    </script>
</body>
</html>
